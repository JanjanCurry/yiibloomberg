function tradeFormPreset(a){var t=$(".chart-item-data[data-chart-id="+a+"]").data();if($("#chartTradeModal").data("chart-id",a),void 0!==t.reporter&&""!=t.reporter){var r=$(".chart-search-list-reporter .list-group-item[data-ref="+t.reporter+"]").data("label");$("#aimReporter").data("ref",t.reporter).typeahead("val",r)}if(void 0!==t.indicator&&$("#aimIndicator").val(t.indicator).selectpicker("refresh"),void 0!==t.partner&&(partners=t.partner.split(","),0<partners.length))for(var e=0;e<partners.length;e++)if(void 0!==partners[e]&&""!=partners[e]){r=$(".chart-search-list-partner .list-group-item[data-ref="+partners[e]+"]").data("label");$("#aimPartner-"+(e+1)).data("ref",partners[e]).typeahead("val",r)}if(void 0!==t.sector&&(t.sector=""+t.sector,sectors=t.sector.split(","),0<sectors.length))for(e=0;e<=sectors.length;e++)if(void 0!==sectors[e]&&""!=sectors[e]){r=$(".chart-search-list-sector .list-group-item[data-ref="+sectors[e]+"]").data("label");$("#aimSector-"+(e+1)).data("ref",sectors[e]).typeahead("val",r)}void 0!==t.compare&&""!=t.compare&&$(".aimSector").each(function(a){0<a&&$(this).hide()}),void 0!==t.requireEditing&&t.requireEditing||($("#chartTradeModal .model-title").text("Edit Indicator"),$("#chartTradeModal .chart-submit-btn").html('<span class="fa fa-pencil"></span> Edit Indicator')),$("#chartTradeModal .chart-submit-btn").data("update","edit"),validateSubmitBtn("trade")}function tradeRefreshTypeahead(a){a=void 0!==a&&a;var t=[],r=void 0!==$("#aimIndicator").val()&&-1!==$("#aimIndicator").val().indexOf("flow-")?"-flow":"",e=void 0!==$("#aimReporter").data("ref")?$("#aimReporter").data("ref"):"";a||(filterLists($("#chartTradeModal .chart-search-list-reporter, #chartCompareModal .chart-search-list-reporter"),{type:"reporter"}),filterLists($("#chartTradeModal .chart-search-list-partner"),{type:"partner"+r,reporter:$("#aimReporter").data("ref")}),filterLists($("#chartTradeModal .chart-search-list-sector"),{type:"sector"+r,reporter:$("#aimReporter").data("ref")})),t.push({selector:".ccmReporter input",url:siteData.data("url")+"/autoComplete/reporterTrade?&term=%QUERY"}),t.push({selector:".aimReporter input",url:siteData.data("url")+"/autoComplete/reporterTrade?term=%QUERY"}),t.push({selector:".aimPartner input",url:siteData.data("url")+"/autoComplete/partner?reporter="+e+"&filterType=partner"+r+"&term=%QUERY"}),t.push({selector:".aimSector input",url:siteData.data("url")+"/autoComplete/sector?reporter="+e+"&filterType=sector"+r+"&term=%QUERY"}),refreshTypeahead("trade",t,a)}function tradeValidateSubmitBtn(){var t=!0,a="";switch(void 0!==$("#chartTradeModal .aimReporter input").data("ref")&&""!=$("#chartTradeModal .aimReporter input").data("ref")?($(".aimIndicator").slideDown(),a=$("#aimReporter").data("ref")):($(".aimIndicator, .aimPartner, .aimSector, aimPartnerLabel, aimSectorLabel").slideUp(),$(".chart-search-list").slideUp(),$("#aimIndicator").val(""),$(".aimSector input, .aimPartner input").data("ref","").typeahead("val",""),t=!1),$("#aimIndicator option").prop("disabled",!1),""!=a&&0<$(".chart-item-data").length&&$(".chart-item-data").each(function(){void 0!==$(this).data("indicator")&&void 0!==$(this).data("reporter")&&$(this).data("reporter")==a&&$(this).data("indicator")!=$("#aimIndicator").val()&&$("#aimIndicator option[value="+$(this).data("indicator")+"]").prop("disabled",!0)}),$("#aimIndicator").selectpicker("refresh"),$("#aimIndicator").val()){case"trade-partner-ev":case"trade-partner-iv":case"trade-partner-tt":$(".aimPartner").slideDown(),$(".aimSector").hide(),$(".aimPartnerLabel").slideDown(),$(".aimSectorLabel").hide();break;case"trade-sector-ev":case"trade-sector-iv":case"trade-sector-tt":$(".aimPartner").hide(),$(".aimSector").slideDown(),$(".aimPartnerLabel").hide(),$(".aimSectorLabel").slideDown();break;case"flow-partner-sector-iv":case"flow-partner-sector-ev":$(".aimPartner").slideDown(),$(".aimSector").hide(),$(".aimSector:first").slideDown(),$(".aimPartnerLabel").slideDown(),$(".aimSectorLabel").slideDown().find(".count").text("1 commodity");break;case"flow-partner-top10-iv":case"flow-partner-top10-ev":$(".aimPartner").hide(),$(".aimPartner:first").slideDown(),$(".aimSector").hide(),$(".aimPartnerLabel").slideDown().find(".count").text("1 partner country"),$(".aimSectorLabel").hide();break;case"flow-sector-partner-iv":case"flow-sector-partner-ev":$(".aimPartner").hide(),$(".aimPartner:first").slideDown(),$(".aimSector").slideDown(),$(".aimPartnerLabel").slideDown().find(".count").text("1 partner country"),$(".aimSectorLabel").slideDown();break;case"flow-sector-top10-iv":case"flow-sector-top10-ev":$(".aimPartner").hide(),$(".aimSector").hide(),$(".aimSector:first").slideDown(),$(".aimPartnerLabel").hide(),$(".aimSectorLabel").slideDown().find(".count").text("1 commodity");break;default:$(".aimPartner").hide(),$(".aimSector").hide(),$(".aimPartnerLabel").hide(),$(".aimSectorLabel").hide()}if(""==$("#aimIndicator").val()&&(t=!1),t){var r=!1;$(".aimPartner").each(function(a){$(this).is(":visible")&&(r=!0)}),r&&(t=!1,$(".aimPartner").each(function(a){$(this).is(":visible")&&void 0!==$(this).find("input").data("ref")&&""!=$(this).find("input").data("ref")&&(t=!0)}))}if(t){var e=!1;$(".aimSector").each(function(a){$(this).is(":visible")&&(e=!0)}),e&&(t=!1,$(".aimSector").each(function(a){$(this).is(":visible")&&void 0!==$(this).find("input").data("ref")&&""!=$(this).find("input").data("ref")&&(t=!0)}))}t?$("#chartTradeModal .chart-submit-btn").addClass("btn-primary btn-inverse").removeClass("btn-disabled"):$("#chartTradeModal .chart-submit-btn").addClass("btn-disabled").removeClass("btn-primary btn-inverse");var i="plus";"edit"==$(".chart-submit-btn").data("update")&&(i="pencil"),$("#chartTradeModal .chart-submit-btn .fa").removeClass().addClass("fa fa-"+i),tradeRefreshTypeahead()}$(function(){tradeRefreshTypeahead(!0)}),$(function(){$("#chartCompareModal").on("show.bs.modal",function(a){if(void 0!==a.relatedTarget)var t=$(a.relatedTarget).parents(".chart-item");else if(0<$(".chart-item[data-chart-id="+$("#chartCompareModal").data("chart-id")+"]").length)t=$(".chart-item[data-chart-id="+$("#chartCompareModal").data("chart-id")+"]");else t=$(".chart-item:first");$("#chartCompareModal").data("chart-id",t.data("chart-id"));var r=$(".chart-item-data[data-chart-id="+t.data("chart-id")+"]").data();if($("#chartCompareModal .chart-search-list-reporter .list-group-item[data-ref="+r.reporter+"]").addClass("list-group-item-disabled"),tradeRefreshTypeahead(),$("#chartCompareModal .form-typeahead input").data("ref","").typeahead("val",""),void 0!==r.compare&&(compare=r.compare.split(","),0<compare.length)){for(var e=0;e<compare.length;e++)if(void 0!==compare[e]&&""!=compare[e]){var i=$(".chart-search-list-reporter .list-group-item[data-ref="+compare[e]+"]").data("label");$("#ccmReporter-"+(e+1)).data("ref",compare[e]).typeahead("val",i)}$(".ccmSearchSave").addClass("btn-primary btn-inverse").removeClass("btn-disabled")}toggleClearBtns()}),$("#chartCompareModal .chart-submit-btn").click(function(){var a=$(this),t=a.parents(".modal").data("chart-id");a.data("code");if(void 0!==t&&!$("#chartCompareModal .modal-body .btn").hasClass("btn-disabled")){var r=[];$("#chartCompareModal .ccmReporter input").each(function(){void 0!==$(this).data("ref")&&""!=$(this).data("ref")&&-1===$.inArray($(this).data("ref"),r)&&r.push($(this).data("ref"))}),r=r.join(),$(".chart-item-data[data-chart-id="+t+"]").data("compare",r),drawChart(t),a.parents(".modal").modal("hide")}})}),$(function(){$("#chartTradeModal").on("show.bs.modal",function(a){if($("#chartTradeModal .model-title").text("Add Indicator"),$("#chartTradeModal .chart-submit-btn").html('<span class="fa fa-plus"></span> Add Indicator'),$("#chartTradeModal .chart-submit-btn").addClass("btn-disabled").removeClass("btn-primary btn-inverse").find(".fa").removeClass().addClass("fa fa-plus"),$("#aimIndicator").val(""),$(".aimReporter input, .aimSector input, .aimPartner input").data("ref","").typeahead("val",""),$(".aimSector input, .aimPartner input").parents(".form-group").hide(),$(".chart-search-list").hide(),$(".aimPartnerLabel").hide().find(".count").text("3 partner countries"),$(".aimSectorLabel").hide().find(".count").text("3 commodities"),$("#chartTradeModal .chart-submit-btn").data("update","add"),void 0!==a.relatedTarget&&0<$(a.relatedTarget).parents(".chart-group").length)(t=$(a.relatedTarget).parents(".chart-group")).hasClass("add-fav")&&$("#chartTradeModal .chart-submit-btn").data("update","favorite");else if(void 0!==$("#chartTradeModal").data("chart-id")&&0<$(".chart-group[data-chart-id="+$("#chartTradeModal").data("chart-id")+"]").length)var t=$(".chart-group[data-chart-id="+$("#chartTradeModal").data("chart-id")+"]");else t=$(".chart-group:first");$("#chartTradeModal").data("chart-id",t.data("chart-id")),$(".aimReporter").hide(),$(".aimIndicator").show(),void 0===t.data("reporter")?($(".aimIndicator").hide(),$(".aimReporter").slideDown()):$("#aimReporter").data("ref",t.data("reporter")),$("#chartTradeModal .chart-search-list-partner .list-group-item").show(),$("#chartTradeModal .chart-search-list-partner .list-group-item[data-ref="+t.data("reporter")+"]").hide(),$(a.relatedTarget).hasClass("chart-edit-btn")?tradeFormPreset($(a.relatedTarget).parents(".chart-item").data("chart-id")):0<t.find(".chart-item-data").length&&void 0!==t.find(".chart-item-data").data("require-editing")&&t.find(".chart-item-data").data("require-editing")&&tradeFormPreset(t.find(".chart-item-data").data("chart-id")),validateSubmitBtn("trade")}),$("#aimIndicator").change(function(){$(".aimPartnerLabel").hide().find(".count").text("3 partner countries"),$(".aimSectorLabel").hide().find(".count").text("3 commodities"),$(".aimSector, .aimPartner").find("input").data("ref","").typeahead("val",""),validateSubmitBtn("trade")}),$("#chartTradeModal .chart-submit-btn").click(function(){var a=$(this),t=a.parents(".modal").data("chart-id"),r=[],e=[];if(!a.hasClass("btn-disabled")){a.parents(".modal").modal("hide");var i=$("#chartTradeModal .aimReporter input").data("ref"),d=!0;if(void 0!==t){if(0==(o=$(".chart-group[data-chart-id="+t+"]")).length)var o=$(".chart-item[data-chart-id="+t+"]").parents(".chart-group");0!=o.length&&(d=!1,renderChartLoading(o),void 0!==o.data("reporter")&&(i=o.data("reporter")))}r=[];$(".aimPartner input").each(function(){void 0!==$(this).data("ref")&&""!=$(this).data("ref")&&-1===$.inArray($(this).data("ref"),r)&&r.push($(this).data("ref"))}),r=r.join();e=[];$(".aimSector input").each(function(){void 0!==$(this).data("ref")&&""!=$(this).data("ref")&&-1===$.inArray($(this).data("ref"),e)&&e.push($(this).data("ref"))}),e=e.join(),"add"==a.data("update")&&void 0!==t&&$.ajax({url:siteData.data("url")+"/trade/chart/",dataType:"json",data:{indicator:$("#aimIndicator").val(),reporter:i,period:o.find(".chart-period").data("period"),editable:o.data("editable"),partner:r,sector:e,view:"data"},success:function(a){if(a.valid)o.find(".chart-group-data").append(a.chart.data),drawChart(a.chart.chartId,d),$(".chart-group-empty").hide();else{if(void 0!==a.error)for(var t in a.error)addFlashMessage("danger",a.error[t]);o.find(".chart-loading").fadeOut(function(){$(this).remove()})}}}),"favorite"==a.data("update")&&$.ajax({url:siteData.data("url")+"/user/addFavorite/",dataType:"json",method:"post",data:{"favorite-type":"trade",indicator:$("#aimIndicator").val(),reporter:i,period:o.find(".chart-period").data("period"),partner:r,sector:e},success:function(a){if(a.valid)$(".trade-add-fav:first").before('<div class="col-sm-6 user-favorite" style="display: none;">'+a.html+"</div>"),$(".chart-item-data[data-chart-id="+a.chartId+"]").parents(".user-favorite").slideDown(),drawChart(a.chartId,d),7<=$(".trade-favorites .chart-group").length&&$(".trade-add-fav").slideDown();else if(void 0!==a.error)for(var t in a.error)addFlashMessage("danger",a.error[t])}}),"edit"==a.data("update")&&void 0!==t&&($(".chart-item-data[data-chart-id="+t+"]").data("partner",r),$(".chart-item-data[data-chart-id="+t+"]").data("sector",e),$(".chart-item-data[data-chart-id="+t+"]").data("indicator",$("#aimIndicator").val()),$(".chart-item-data[data-chart-id="+t+"]").data("require-editing",!1),drawChart(t,d))}}),$(".chartTypeField input").click(function(){$(".chartTypeField input").parents(".btn").removeClass("btn-primary"),$(this).parents(".btn").addClass("btn-primary")})});