function refreshChartDatepicker(a){var r=moment().startOf("month").subtract(2,"months"),d=moment().startOf("month").add(2,"months"),t=$(".chart-item-data[data-chart-id="+a.data("chart-id")+"]");if(""!==$("#ctmStartDate").val()&&(r=moment("1 "+$("#ctmStartDate").val(),"D MMM YYYY")),""!==$("#ctmEndDate").val()&&(d=moment($("#ctmEndDate").val(),"MMM YYYY")),void 0!==t.data("start-time")&&""!==t.data("start-time")&&(r=moment(t.data("start-time"),"MMM YYYY")),void 0!==t.data("end-time")&&""!==t.data("end-time")&&(d=moment(t.data("end-time"),"MMM YYYY")),d<r){var e=r;r=d,d=e}void 0!==$("#ctmStartDate").data("DateTimePicker")&&($("#ctmStartDate").data("DateTimePicker").destroy(),$("#ctmEndDate").data("DateTimePicker").destroy());var i="";0<a.length&&(i=a.parents(".chart-group").find(".chart-time").data("chart-type")),void 0!==i&&""!==i||(i=$(".chart-time").data("type")),$.ajax({url:siteData.data("url")+"/site/chartDateLimit/",dataType:"json",data:"type="+i,success:function(a){var t=moment(a.min,"D MMM YYYY"),e=moment(a.max,"D MMM YYYY");r<t&&(r=t),e<d&&(d=e),$("#ctmStartDate").datetimepicker({viewMode:"annual"==$(".chart-period").data("period")?"years":"months",format:"MMM YYYY",inline:!0,minDate:t,maxDate:e,defaultDate:r}),$("#ctmEndDate").datetimepicker({viewMode:"annual"==$(".chart-period").data("period")?"years":"months",format:"MMM YYYY",inline:!0,minDate:t,maxDate:e,defaultDate:d}),$("#chartTimeModal .monthPicker").data("min-date",t.format("YYYY")),$("#chartTimeModal .monthPicker").data("max-date",e.format("YYYY")),$("#chartTimeModal  .monthPicker").on("dp.show dp.update",function(){$(".datepicker-years .picker-switch").removeAttr("title").on("click",function(a){a.stopPropagation()});var a=parseInt($(this).data("min-date")),t=parseInt($(this).data("max-date"));$(".datepicker-years tbody td span").remove();for(var e=a;e<=t;e++)$(".datepicker-years tbody td").append('<span data-action="selectYear" class="year">'+e+"</span>");$(".datepicker-years .picker-switch").text(a+"-"+t),$(".datepicker-years .prev, .datepicker-years .next").addClass("disabled")}).trigger("dp.update")}})}$(function(){refreshChartDatepicker($(".chart-item:first")),$("#chartTimeModal").on("show.bs.modal",function(a){if(void 0!==a.relatedTarget&&0<$(a.relatedTarget).parents(".chart-item").length){var t=$(a.relatedTarget).parents(".chart-item");$("#chartTimeModal").data({"chart-id":t.data("chart-id"),"chart-group":0})}else{t=$(".chart-item:first");$("#chartTimeModal").data({"chart-id":"","chart-group":1})}refreshChartDatepicker(t)}),$("#ctmStartDate, #ctmEndDate").on("dp.change",function(a){""!=$(this).val()?$("#chartTimeModal .modal-body .btn").addClass("btn-primary btn-inverse").removeClass("btn-disabled"):$("#chartTimeModal .modal-body .btn").addClass("btn-disabled").removeClass("btn-primary btn-inverse")}),$("#chartTimeModal .chart-submit-btn").click(function(){var a=$(this),t=a.parents(".modal").data("chart-id"),e=moment($("#ctmStartDate").val(),"MMM YYYY"),r=moment($("#ctmEndDate").val(),"MMM YYYY");if(r<e){var d=e;e=r,r=d}if($(".chart-period").length&&void 0!==$(".chart-period").data("period")&&$(".chart-period").data("period"),1==$("#chartTimeModal").data("chart-group")){$(".chart-item").each(function(){var a=$(this).data("chart-id");$(".chart-item-data[data-chart-id="+a+"]").data("start-time",e.format("MMM YYYY")),$(".chart-item-data[data-chart-id="+a+"]").data("end-time",r.format("MMM YYYY")),$(".chart-item-data[data-chart-id="+a+"]").data("session","set"),drawChart(a)});var i={month:"MMM YYYY",quarter:"YYYY [Q]Q",annual:"YYYY"};for(var c in i)$(".chart-time ."+c).text(e.format(i[c])+" - "+r.format(i[c]));a.parents(".modal").modal("hide"),$(".chart-time, #chartTimeModal").data("start",e.format("MMM YYYY")).data("end",r.format("MMM YYYY"))}else $("#chartTimeModal .modal-body .btn").hasClass("btn-disabled")||(void 0!==t&&($(".chart-item-data[data-chart-id="+t+"]").data("start-time",e.format("MMM YYYY")),$(".chart-item-data[data-chart-id="+t+"]").data("end-time",r.format("MMM YYYY")),$(".chart-item-data[data-chart-id="+t+"]").data("session","none"),drawChart(t)),a.parents(".modal").modal("hide"))})}),$(function(){$("#chartTypeModal").on("show.bs.modal",function(a){var t=$(a.relatedTarget).parents(".chart-item");$("#chartTypeModal").data("chart-id",t.data("chart-id"));var e=$(".chart-item-data[data-chart-id="+t.data("chart-id")+"]").data();$("#chartTypeModal .chartTypeField input").each(function(){$(this).prop("disabled",!1),$(this).parents(".btn").removeClass("btn-disabled"),$(this).addClass("hidden"),$(this).prop("checked")?$(this).parents(".btn").addClass("btn-primary"):$(this).parents(".btn").removeClass("btn-primary")}),$("#chartTypeModal .chartTypeField input").prop("checked",!1),$("#chartTypeModal .chartTypeField input[value="+e.chartType+"]").prop("checked",!0).trigger("click")}),$("#chartTypeModal .chart-submit-btn").click(function(){var a=$(this),t=a.parents(".modal").data("chart-id");if(void 0!==t){var e="line";$("#chartTypeModal .chartTypeField input").each(function(){$(this).prop("checked")&&(e=$(this).val())}),$(".chart-item-data[data-chart-id="+t+"]").data("chart-type",e),drawChart(t),a.parents(".modal").modal("hide")}}),$("#chartTypeModal .chartTypeField input").click(function(){$("#chartTypeModal .chartTypeField input").parents(".btn").removeClass("btn-primary"),$(this).parents(".btn").addClass("btn-primary")})});