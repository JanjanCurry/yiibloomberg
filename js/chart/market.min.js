function marketFormPreset(a){var t=$(".chart-item-data[data-chart-id="+a+"]").data();if($("#chartMarketModal").data("chart-id",a),void 0!==t.item&&(item=t.item.split(","),0<item.length))for(var e=0;e<=item.length;e++)if(void 0!==item[e]&&""!=item[e]){var r=$(".chart-search-list .list-group-item[data-ref="+item[e]+"]").data("label");$("#chartMarketModal ."+t.market+"-search input").data("ref",item[e]).typeahead("val",r)}void 0!==t.requireEditing&&t.requireEditing||($("#chartMarketModal .model-title").text("Edit Asset"),$("#chartMarketModal .chart-submit-btn").addClass("btn-primary btn-inverse").removeClass("btn-disabled").find(".fa").removeClass().addClass("fa fa-pencil")),$("#chartMarketModal .chart-submit-btn").data("update","edit")}function marketRefreshTypeahead(a){a=void 0!==a&&a;var t=[];$(".chart-item-data").each(function(){void 0!==$(this).data("item")&&t.push($(this).data("item"))}),t.join(),a||(filterLists($("#chartMarketModal .chart-search-list-commodity, #chartMarketCompareModal .chart-search-list-commodity"),{type:"commodity",restrict:t,selected:t}),filterLists($("#chartMarketModal .chart-search-list-currency, #chartMarketCompareModal .chart-search-list-currency"),{type:"currency",restrict:t,selected:t}),filterLists($("#chartMarketModal .chart-search-list-equity, #chartMarketCompareModal .chart-search-list-equity"),{type:"equity",restrict:t,selected:t}));var e=[];e.push({selector:".commodity-search input",url:siteData.data("url")+"/autoComplete/commodity?restrict="+t+"&term=%QUERY"}),e.push({selector:".currency-search input",url:siteData.data("url")+"/autoComplete/currency?restrict="+t+"&term=%QUERY"}),e.push({selector:".equity-search input",url:siteData.data("url")+"/autoComplete/equity?restrict="+t+"&term=%QUERY"}),e.push({selector:".commodity-compare input",url:siteData.data("url")+"/autoComplete/commodity?restrict="+t+"&term=%QUERY"}),e.push({selector:".currency-compare input",url:siteData.data("url")+"/autoComplete/currency?restrict="+t+"&term=%QUERY"}),e.push({selector:".equity-compare input",url:siteData.data("url")+"/autoComplete/equity?restrict="+t+"&term=%QUERY"}),refreshTypeahead("market",e,a)}function marketValidateSubmitBtn(){var a=!0;a&&(a=!1,$("#chartMarketModal .market-search input").each(function(){void 0!==$(this).data("ref")&&""!=$(this).data("ref")&&(a=!0)})),a?$("#chartMarketModal .chart-submit-btn").addClass("btn-primary btn-inverse").removeClass("btn-disabled"):$("#chartMarketModal .chart-submit-btn").addClass("btn-disabled").removeClass("btn-primary btn-inverse")}$(function(){marketRefreshTypeahead(!0)}),$(function(){$("#chartMarketCompareModal").on("show.bs.modal",function(a){if(void 0!==a.relatedTarget)var t=$(a.relatedTarget).parents(".chart-item");else if(0<$(".chart-item[data-chart-id="+$("#chartMarketCompareModal").data("chart-id")+"]").length)t=$(".chart-item[data-chart-id="+$("#chartMarketCompareModal").data("chart-id")+"]");else t=$(".chart-item:first");$("#chartMarketCompareModal").data("chart-id",t.data("chart-id"));var e=$(".chart-item-data[data-chart-id="+t.data("chart-id")+"]").data(),r=void 0!==e.marketCompare&&0<e.marketCompare.length?e.marketCompare:e.market;if($("#chartMarketCompareModal #market-compare-market").selectpicker("val",r).trigger("changed.bs.select"),$("#chartMarketCompareModal .market-compare input").data("ref","").typeahead("val",""),marketRefreshTypeahead(),void 0!==e.compare&&(item=e.compare.split(","),0<item.length))for(var d=0;d<=item.length;d++)if(void 0!==item[d]&&""!=item[d]){var i=$(".chart-search-list .list-group-item[data-ref="+item[d]+"]").data("label");$("#chartMarketCompareModal ."+e.marketCompare+"-compare input").data("ref",item[d]).typeahead("val",i).trigger("change")}validateSubmitBtn("market-compare")}),$("#chartMarketCompareModal #market-compare-market").on("changed.bs.select",function(){var a=$(this).val();$("#chartMarketCompareModal .market-compare").slideUp(),$("#chartMarketCompareModal .market-compare:not(."+a+"-compare) input").data("ref","").typeahead("val",""),$("#chartMarketCompareModal .market-compare."+a+"-compare").slideDown(),validateSubmitBtn("market-compare")}),$("#chartMarketCompareModal .chart-submit-btn").click(function(){var a=$(this),t=a.parents(".modal").data("chart-id");a.data("code");if(void 0!==t){var e=[];$("#chartMarketCompareModal .market-compare input").each(function(){void 0!==$(this).data("ref")&&""!=$(this).data("ref")&&-1===$.inArray($(this).data("ref"),e)&&e.push($(this).data("ref"))}),e=e.join(),$(".chart-item-data[data-chart-id="+t+"]").data("compare",e),$(".chart-item-data[data-chart-id="+t+"]").data("market-compare",$("#chartMarketCompareModal #market-compare-market").val()),drawChart(t),a.parents(".modal").modal("hide")}})}),$(function(){$("#chartMarketModal").on("show.bs.modal",function(a){if($("#chartMarketModal .model-title").text("Add Asset"),$("#chartMarketModal .chart-submit-btn").html('<span class="fa fa-plus"></span> Add Asset'),$("#chartMarketModal .chart-submit-btn").addClass("btn-disabled").removeClass("btn-primary btn-inverse").find(".fa").removeClass().addClass("fa fa-plus"),$(".market-search input").data("ref","").typeahead("val",""),$("#chartMarketModal .market-list").hide(),$("#chartMarketModal .chart-submit-btn").data("update","add"),void 0!==a.relatedTarget&&0<$(a.relatedTarget).parents(".chart-group").length)(t=$(a.relatedTarget).parents(".chart-group")).hasClass("add-fav")&&$("#chartMarketModal .chart-submit-btn").data("update","favorite");else if(void 0!==$("#chartMarketModal").data("chart-id")&&0<$(".chart-group[data-chart-id="+$("#chartMarketModal").data("chart-id")+"]").length)var t=$(".chart-group[data-chart-id="+$("#chartMarketModal").data("chart-id")+"]");else t=$(".chart-group:first");var e=t.data("chart-type");if($("#chartMarketModal").data({"chart-id":t.data("chart-id"),type:e}),$("#chartMarketModal .market-search").hide(),$("#chartMarketModal .market-search."+e+"-search").show(),$(a.relatedTarget).hasClass("chart-edit-btn"))marketFormPreset(r=$(a.relatedTarget).parents(".chart-item").data("chart-id")),$("#chartMarketModal").data({"chart-id":r});else if(0<t.find(".chart-item-data").length&&void 0!==t.find(".chart-item-data").data("require-editing")&&t.find(".chart-item-data").data("require-editing")){var r;marketFormPreset(r=t.find(".chart-item-data").data("chart-id")),$("#chartMarketModal").data({"chart-id":r})}marketRefreshTypeahead(),validateSubmitBtn("market")}),$(".market-search input").on("typeahead:selected",function(a,t,e){$(this).data("ref",t.code),validateSubmitBtn("market")}).on("keyup",function(a){""==$(this).typeahead("val")?($(this).data("ref",""),validateSubmitBtn("market")):13==a.which&&0<$(this).parents(".form-group").find(".tt-suggestion:first-child").length&&$(this).parents(".form-group").find(".tt-suggestion:first-child").trigger("click")}),$("#chartMarketModal .chart-submit-btn").click(function(){var a=$(this),t=a.parents(".modal").data("chart-id");if(!a.hasClass("btn-disabled")){a.parents(".modal").modal("hide");var e=a.parents(".modal").data("type"),r=!0;if(void 0!==t){if(0==(d=$(".chart-group[data-chart-id="+t+"]")).length)var d=$(".chart-item[data-chart-id="+t+"]").parents(".chart-group");0!=d.length&&(r=!1,renderChartLoading(d))}var i=[];$(".market-search input").each(function(a){void 0!==$(this).data("ref")&&""!=$(this).data("ref")&&-1===$.inArray($(this).data("ref"),i)&&i.push($(this).data("ref"))}),i=i.join(),"add"==a.data("update")&&void 0!==t&&$.ajax({url:siteData.data("url")+"/"+e+"/chart/",dataType:"json",data:{item:i,period:d.find(".chart-period").data("period"),view:"data",editable:d.data("editable")},success:function(a){if(a.valid)d.find(".chart-group-data").append(a.chart.data),drawChart(a.chart.chartId,r),$(".chart-group-empty").slideUp();else if("string"==typeof a.error&&""!=a.error)addFlashMessage("danger",a.error),data.data("compare","");else{if(void 0!==a.error)for(var t in a.error)addFlashMessage("danger",a.error[t]);d.find(".chart-loading").fadeOut(function(){$(this).remove()})}}}),"favorite"==a.data("update")&&$.ajax({url:siteData.data("url")+"/user/addFavorite/",dataType:"json",method:"post",data:{item:i,period:d.find(".chart-period").data("period"),"favorite-type":e},success:function(a){if(a.valid)$(".market-add-fav:first").before('<div class="col-sm-6 user-favorite" style="display: none;">'+a.html+"</div>"),$(".chart-item-data[data-chart-id="+a.chartId+"]").parents(".user-favorite").slideDown(),drawChart(a.chartId,r),7<=$(".market-favorites .chart-group").length&&$(".market-add-fav").slideDown();else if(void 0!==a.error)for(var t in a.error)addFlashMessage("danger",a.error[t])}}),"edit"==a.data("update")&&void 0!==t&&($(".chart-item-data[data-chart-id="+t+"]").data("item",i),drawChart(t,r))}})});