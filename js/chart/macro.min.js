function macroFormPreset(a){var r=$(".chart-item-data[data-chart-id="+a+"]").data();if($("#chartMacroModal").data("chart-id",a),$("#macroType").val(r.macro).trigger("change"),void 0!==r.reporter&&(reporter=r.reporter.split(","),0<reporter.length))for(var t=0;t<=reporter.length;t++)if(void 0!==reporter[t]&&""!=reporter[t]){var e=$(".chart-search-list-reporter .list-group-item[data-ref="+reporter[t]+"]").data("label");$("#macroCountry-"+(t+1)).data("ref",reporter[t]).typeahead("val",e)}void 0!==r.compare&&""!=r.compare&&$(".macro-country-compare").hide(),void 0!==r.requireEditing&&r.requireEditing||($("#chartMacroModal .model-title").text("Edit Macro"),$("#chartMacroModal .chart-submit-btn").html('<span class="fa fa-plus"></span> Edit Macro'),$("#chartMacroModal .chart-submit-btn").addClass("btn-primary btn-inverse").removeClass("btn-disabled").find(".fa").removeClass().addClass("fa fa-pencil")),$("#chartMacroModal .chart-submit-btn").data("update","edit")}function macroRefreshTypeahead(a){(a=void 0!==a&&a)||filterLists($("#chartMacroModal .chart-search-list-reporter"),{type:"macro",macro:$("#chartMacroModal #macroType").selectpicker("val")});var r=[];r.push({selector:".macro-country input",url:siteData.data("url")+"/autoComplete/reporterMacro?period="+$(".chart-period").data("period")+"&macro="+$("#chartMacroModal #macroType").val()+"&term=%QUERY"}),refreshTypeahead("macro",r,a)}function macroValidateSubmitBtn(){var a=!0;""==$("#macroType").val()&&(a=!1),a&&(a=!1,$(".macro-country input").each(function(){void 0!==$(this).data("ref")&&""!=$(this).data("ref")&&(a=!0)})),a?$("#chartMacroModal .chart-submit-btn").addClass("btn-primary btn-inverse").removeClass("btn-disabled"):$("#chartMacroModal .chart-submit-btn").addClass("btn-disabled").removeClass("btn-primary btn-inverse")}$(function(){macroRefreshTypeahead(!0)}),$(function(){$("#chartCompareModal").on("show.bs.modal",function(a){if($(".compareMacroSelect option").prop("disabled",!1).prop("selected",!1),$(".compareMacroSelect select").val("").trigger("change"),void 0!==a.relatedTarget)var r=$(a.relatedTarget).parents(".chart-item");else if(0<$(".chart-item[data-chart-id="+$("#chartCompareModal").data("chart-id")+"]").length)r=$(".chart-item[data-chart-id="+$("#chartCompareModal").data("chart-id")+"]");else r=$(".chart-item:first");$("#chartCompareModal").data("chart-id",r.data("chart-id"));var t=$(".chart-item-data[data-chart-id="+r.data("chart-id")+"]").data();if(filterLists($("#chartCompareModal .compareMacroSelect"),{type:"macro",period:t.period,reporter:t.reporter,variant:t.variant},"dropdown"),setTimeout(function(){$("#chartCompareModal .compareMacroSelect option[value="+t.macro+"]").prop("disabled",!0),$(".selectpicker").selectpicker("refresh")},1e3),void 0!==t.compare&&(compare=t.compare.split(","),0<compare.length))for(var e=0;e<=compare.length;e++)void 0!==compare[e]&&""!=compare[e]&&$("#compareMacro-"+(e+1)).val(compare[e]).trigger("change")}),$("#chartCompareModal .chart-submit-btn").click(function(){var a=$(this),r=a.parents(".modal").data("chart-id");a.data("code");if(void 0!==r){var t=[];$("#chartCompareModal .compareMacroSelect select").each(function(a){""!=$(this).val()&&-1===$.inArray($(this).val(),t)&&t.push($(this).val())}),t=t.join(),$(".chart-item-data[data-chart-id="+r+"]").data("compare",t),drawChart(r),a.parents(".modal").modal("hide")}})}),$(function(){$("#chartMacroModal").on("show.bs.modal",function(a){if($("#chartMacroModal .model-title").text("Add Macro"),$("#chartMacroModal .chart-submit-btn").html('<span class="fa fa-plus"></span> Add Macro'),$("#chartMacroModal .chart-submit-btn").addClass("btn-disabled").removeClass("btn-primary btn-inverse").find(".fa").removeClass().addClass("fa fa-plus"),$(".macro-country input").data("ref","").typeahead("val",""),$(".chart-search-list, .macro-country").hide(),$("#chartMacroModal .chart-submit-btn").data("update","add"),void 0!==a.relatedTarget&&0<$(a.relatedTarget).parents(".chart-group").length)(r=$(a.relatedTarget).parents(".chart-group")).hasClass("add-fav")&&$("#chartMacroModal .chart-submit-btn").data("update","favorite");else if(void 0!==$("#chartMacroModal").data("chart-id")&&0<$(".chart-group[data-chart-id="+$("#chartMacroModal").data("chart-id")+"]").length)var r=$(".chart-group[data-chart-id="+$("#chartMacroModal").data("chart-id")+"]");else r=$(".chart-group:first");$("#chartMacroModal").data("chart-id",r.data("chart-id")),$(a.relatedTarget).hasClass("chart-edit-btn")?macroFormPreset($(a.relatedTarget).parents(".chart-item").data("chart-id")):0<r.find(".chart-item-data").length&&void 0!==r.find(".chart-item-data").data("require-editing")&&r.find(".chart-item-data").data("require-editing")?macroFormPreset(r.find(".chart-item-data").data("chart-id")):$("#macroType").val("").trigger("change"),macroRefreshTypeahead(),macroValidateSubmitBtn()}),$("#macroType").change(function(){var a=$("#chartMacroModal").data("chart-id"),r="";if(void 0!==a){var t=$(".chart-item-data[data-chart-id="+a+"]");void 0!==t&&void 0!==t.data("compare")&&""!=t.data("compare")&&(r=":first")}""!=$(this).val()?$(".macro-country"+r).slideDown():$(".macro-country").hide(),macroRefreshTypeahead(),macroValidateSubmitBtn()}),$("#chartMacroModal .chart-submit-btn").click(function(){var a=$(this),r=a.parents(".modal").data("chart-id");if(!a.hasClass("btn-disabled")){a.parents(".modal").modal("hide");var t=!0;if(void 0!==r){if(0==(e=$(".chart-group[data-chart-id="+r+"]")).length)var e=$(".chart-item[data-chart-id="+r+"]").parents(".chart-group");0!=e.length&&(t=!1,renderChartLoading(e))}var d=[],o=[];$(".cmReporter input").each(function(a){void 0!==$(this).data("ref")&&""!=$(this).data("ref")&&-1===$.inArray($(this).data("ref"),o)&&(d.push($(this).data("ref")),o.push($(this).data("ref")))}),d=d.join(),"add"==a.data("update")&&void 0!==r&&$.ajax({url:siteData.data("url")+"/macro/chart/",dataType:"json",data:{editable:e.data("editable"),macro:$("#macroType").val(),period:e.find(".chart-period").data("period"),reporter:d,view:"data"},success:function(a){if(a.valid)e.find(".chart-group-data").append(a.chart.data),drawChart(a.chart.chartId,t),$(".chart-group-empty").slideUp();else{if(void 0!==a.error)for(var r in a.error)addFlashMessage("danger",a.error[r]);e.find(".chart-loading").fadeOut(function(){$(this).remove()})}}}),"favorite"==a.data("update")&&$.ajax({url:siteData.data("url")+"/user/addFavorite/",dataType:"json",method:"post",data:{"favorite-type":"macro",macro:$("#macroType").val(),period:"annual",reporter:d},success:function(a){if(a.valid)$(".macro-add-fav:first").before('<div class="col-sm-6 user-favorite" style="display: none;">'+a.html+"</div>"),$(".chart-item-data[data-chart-id="+a.chartId+"]").parents(".user-favorite").slideDown(),drawChart(a.chartId,t),7<=$(".macro-favorites .chart-group").length&&$(".macro-add-fav").slideDown();else if(void 0!==a.error)for(var r in a.error)addFlashMessage("danger",a.error[r])}}),"edit"==a.data("update")&&void 0!==r&&($(".chart-item-data[data-chart-id="+r+"]").data("macro",$("#macroType").val()),$(".chart-item-data[data-chart-id="+r+"]").data("reporter",d),drawChart(r,t))}})});