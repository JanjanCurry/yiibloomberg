function toggleChartSeries(t,a){a=void 0!==a&&a;var e=chartsLog[t],i=$("#chart-legend-"+t);viewData=new google.visualization.DataView(e.chartData),viewOptions=$.extend(!0,{},e.options),viewPrintOptions=$.extend(!0,{},e.printOptions),viewPrintOptions.colors=viewOptions.colors=[],viewPrintOptions.series=viewOptions.series={};var r=0,o=[];if(i.find(".chart-legend-item").each(function(t){col=parseInt($(this).data("col")),$(this).hasClass("active")?(viewOptions.series[r]=e.options.series[col-1],viewPrintOptions.series[r]=e.options.series[col-1],r++):o.push(col)}),0<o.length&&viewData.hideColumns(o),e.chartObj.draw(viewData,viewOptions),void 0!==i.data("double-draw-hack")&&"active"===i.data("double-draw-hack")?e.chartObj.draw(viewData,viewOptions):i.data("double-draw-hack","active"),a)if(e.drawPrint)e.chartObjPrint.draw(viewData,viewOptions);else{var d=google.visualization.events.addListener(e.chartObjPrint,"ready",function(){google.visualization.events.removeListener(d),e.chartObjPrint.draw(viewData,viewPrintOptions)});e.chartObjPrint.draw(e.chartData,e.printOptions)}chartsLog[t].viewData=viewData,chartsLog[t].viewOptions=viewOptions,chartsLog[t].viewPrintOptions=viewPrintOptions}function loadCharts(){google.charts.load("current",{packages:["corechart"],callback:drawCharts}),$("body").data("google-load",0),setTimeout(function(){"undefined"!=typeof google&&void 0!==google.visualization&&0===$("body").data("google-load")&&drawCharts()},15e3)}function drawCharts(){$("body").data("google-load",1),$(".chart-group .chart-group-data .chart-item-data").each(function(){void 0!==$(this).data("require-editing")&&$(this).data("require-editing")?(0<$("#chartTradeModal").length&&$("#chartTradeModal").modal("show"),0<$("#chartMacroModal").length&&$("#chartMacroModal").modal("show"),0<$("#chartMarketModal").length&&$("#chartMarketModal").modal("show")):drawChart($(this).data("chart-id"))}),$(".content .modal").each(function(){$(this).appendTo($("body"))})}$(function(){loadCharts(),$(window).resize(function(){this.resizeTO&&clearTimeout(this.resizeTO),this.resizeTO=setTimeout(function(){$(this).trigger("resizeEnd")},500)}),$(window).on("resizeEnd",function(){var t;for(t in chartsLog)toggleChartSeries(t);$("#home-fav").data("resized","false")}),$(document).on("click",".download-btn",function(){var t=$(this).parents(".chart-item").data("chart-id");void 0!==t&&renderPrintableChart(t,"image")}),$(document).on("click",".chart-group-png",function(){var t;$(this).parents(".chart-group").find(".chart-item").each(function(){renderPrintableChart(t=$(this).data("chart-id"))}),renderPrintableChart(t,"imageMulti")}),$(document).on("click",".csv-btn",function(){downloadCSV($(this).parents(".chart-item").data("chart-id"))}),$(document).on("click",".chart-group-csv",function(){var t=[];$(this).parents(".chart-group").find(".chart-item").each(function(){t.push($(this).data("chart-id"))}),downloadCSV(t)}),$(document).on("click",".pdf-btn",function(){var t=$(this).parents(".chart-item").data("chart-id");void 0!==t&&renderPrintableChart(t,"pdf")}),$(document).on("click",".chart-group-pdf",function(){var e=[],i=$(this).parents(".chart-group").find(".chart-item").length;$(this).parents(".chart-group").find(".chart-item").each(function(t){var a=$(this).data("chart-id");e.push(a),renderPrintableChart(a,t+1===i?"pdfMulti":null)})}),$(document).on("click",".chart-btn-remove",function(){var t=$(this).parents(".chart-item").data("chart-id");$(".chart-item-data[data-chart-id="+t+"]").remove(),$(".chart-item[data-chart-id="+t+"], .chart-item-table[data-chart-id="+t+"]").slideUp(function(){$(this).remove()}),0===$(".chart-item-data").length&&$(".chart-group-empty").slideDown()}),$(document).on("click",".chart-group-remove",function(){$(this).parents(".chart-group").find(".chart-item").each(function(){var t=$(this).data("chart-id");$(".chart-item-data[data-chart-id="+t+"]").remove(),$(".chart-item[data-chart-id="+t+"], .chart-item-table[data-chart-id="+t+"]").slideUp(function(){$(this).remove()})}),0===$(".chart-item-data").length&&$(".chart-group-empty").slideDown()}),$(document).on("click",".chart-btn-reset",function(){var t=$(this).parents(".chart-item").data("chart-id");$(".chart-item-data[data-chart-id="+t+"]").data("compare","").data("start-time","").data("end-time",""),drawChart(t)}),$(document).on("click",".chart-group-reset",function(){$(this).parents(".chart-group").find(".chart-item").each(function(){var t=$(this).data("chart-id");$(".chart-item-data[data-chart-id="+t+"]").data("compare","").data("start-time","").data("end-time",""),drawChart(t)})}),$(document).on("click",".chart-group-change-date",function(){$("#chartTimeModal").modal("show"),$("#chartTimeModal").data("chart-group",1)}),$(document).on("click",".chart-notes-btn",function(){var t=$(this).parents(".chart-item-table").data("chart-id");$(this).parents(".chart-item-table").find(".chart-notes").slideToggle(),$(".chart-item[data-chart-id="+t+"] .chart-notes").slideToggle(),$(".chart-item[data-chart-id="+t+"] .chart-notes").slideToggle()}),$(document).on("click",".chart-legend-item",function(){$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active"),0<$(this).parents(".chart-item-legend").find(".chart-legend-item.active").length?toggleChartSeries($(this).parents(".chart-item").data("chart-id")):$(this).addClass("active")}),$(".chart-period .btn").click(function(){var a=$(this).data("period");$(".chart-period .btn").addClass("btn-default").removeClass("btn-primary"),$(this).addClass("btn-primary"),$(this).parents(".chart-period").data("period",a),$(".chart-time a span").hide(),$(".chart-time a span."+a).show(),$(this).parents(".chart-group").find(".chart-item-data").each(function(){var t=$(this).data("chart-id");$(this).data("period",a),drawChart(t)})}),$(document).on("click",".mom-row-toggle-btn",function(){var t=$(this).data("open"),a=$(this).parents(".mom-row").data("group");1===t?($(this).data("open",0),$(this).find(".fa").addClass("fa-plus").removeClass("fa-minus")):($(this).data("open",1),$(this).find(".fa").addClass("fa-minus").removeClass("fa-plus")),$(this).parents("table").find(".mom-row").each(function(){console.log($(this).data("group"),a,$(this).data("group")===a),$(this).hasClass("mom-row-toggle")||$(this).data("group")!==a||(1===t?$(this).parents("tr").hide():$(this).parents("tr").show())})}),$(document).on("click",".correlation-row-toggle-btn",function(){1===$(this).data("open")?($(this).data("open",0),$(this).find(".fa").addClass("fa-plus").removeClass("fa-minus"),$(this).parents("tr").find(".correlation-row-info").hide()):($(this).data("open",1),$(this).find(".fa").addClass("fa-minus").removeClass("fa-plus"),$(this).parents("tr").find(".correlation-row-info").show())})});var chartDrawCount=0;function drawChart(o,t){var a=$(".chart-item-data[data-chart-id="+o+"]"),d=a.parents(".chart-group");chartDrawCount++,(t=void 0===t||t)&&renderChartLoading(d);var e="/trade/chart/";void 0!==d.data("chart-type")&&(e="/"+d.data("chart-type")+"/chart/"),a=a.data(),0<$("#ctmStartDate").length&&(a.startTime=$("#ctmStartDate").val()),0<$("#ctmEndDate").length&&(a.endTime=$("#ctmEndDate").val()),$.ajax({url:siteData.data("url")+e,type:"post",dataType:"json",contentType:"application/x-www-form-urlencoded",data:a,success:function(t){if(t.valid){var e=$(".chart-item-data").length;if($(".chart-item-data").each(function(t){$(this).data("chart-position",t),$(this).data("chart-id")===o&&(e=t)}),!d.find(".chart-item[data-chart-id="+o+"]").length){var i='<div class="chart-item '+t.chart.col+'" data-chart-id="'+o+'"><div class="chart-item-header-container" data-chart-id="'+o+'"></div><div class="chart-item-chart-container"><div class="chart-item-chart" id="'+o+'"></div></div><p class="chart-item-source"></p><p class="chart-notes"></p></div>',r=!1;0===$(".chart-print").length&&$("body").append('<div class="chart-print"></div>'),0===$(".chart-legend-print-"+o).length&&$(".chart-print").append('<div class="chart-print-item"><div class="chart-print-legend" id="chart-print-legend-'+o+'"></div><div class="chart-print-chart-box"><div class="chart-print-chart" id="'+o+'-print"></div></div></div>'),0<d.find(".chart-item").length&&d.find(".chart-item").each(function(t){if(!r){var a=$(".chart-item-data[data-chart-id="+$(this).data("chart-id")+"]");void 0!==a&&(parseInt(a.data("chart-position"))===e-1?(r=!0,$(this).after(i)):parseInt(a.data("chart-position"))===e+1&&(r=!0,$(this).before(i)))}}),r||d.find(".chart-group-chart").append(i)}if(!d.find(".chart-item-table[data-chart-id="+o+"]").length){i='<div class="chart-item-table" data-chart-id="'+o+'"></div>',r=!1;0<d.find(".chart-item-table").length&&d.find(".chart-item-table").each(function(t){if(!r){var a=$(".chart-item-data[data-chart-id="+$(this).data("chart-id")+"]");void 0!==a&&(parseInt(a.data("chart-position"))===e-1?(r=!0,$(this).after(i)):parseInt(a.data("chart-position"))===e+1&&(r=!0,$(this).before(i)))}}),r||d.find(".chart-group-table").append(i)}if(void 0!==t.error)for(var a in t.error)addFlashMessage("danger",t.error[a]);renderChart(t.chart),refreshForm(),loadingCount=parseInt(d.find(".chart-loading").data("count"))-1,d.find(".chart-loading").data("count",loadingCount),loadingCount<1&&d.find(".chart-loading").fadeOut(function(){$(this).remove()})}else{if(void 0!==t.error)for(var a in t.error)addFlashMessage("danger",t.error[a]),d.find(".chart-item-table[data-chart-id="+o+"]").remove(),d.find(".chart-item[data-chart-id="+o+"]").remove();refreshForm(),d.find(".chart-loading").fadeOut(function(){$(this).remove()})}},error:function(t){refreshForm(),d.find(".chart-loading").fadeOut(function(){$(this).remove()})}})}function renderChart(t){var a=$(".chart-item-data[data-chart-id="+t.chartId+"]"),e=a.parents(".chart-group");if(void 0!==t.html)return e.find("#"+t.chartId).html(t.html),!1;var i=e.find(".chart-item-table[data-chart-id="+t.chartId+"]");i.html(t.table),i.find(".mom-row").each(function(){$(this).hasClass("mom-row-toggle")?$(this).prepend('<a href="#" class="mom-row-toggle-btn" data-open="0"><i class="fa fa-plus"></i></a> '):$(this).parents("tr").hide()}),i.find(".correlation-row").each(function(){$(this).prepend('<a href="#" class="correlation-row-toggle-btn" data-open="0"><i class="fa fa-plus"></i></a> '),$(this).parents("tr").find(".correlation-row-info").hide()}),tableFixedHeader(),e.find(".chart-item-header-container[data-chart-id="+t.chartId+"]").html(t.title),a.data("title",e.find(".chart-item-header-container[data-chart-id="+t.chartId+"] .chart-item-title").attr("title")),a.data("url",t.url),void 0!==t.source&&0<t.source.length&&(e.find(".chart-item[data-chart-id="+t.chartId+"] .chart-item-source").text("Source(s): "+t.source.join(", ")).show(),a.data("source",t.source.join(", "))),void 0===t.notes||$.isEmptyObject(t.notes)?a.data("notes",""):(notesArr=$.map(t.notes,function(t){return t}),$(".chart-item[data-chart-id="+t.chartId+"] .chart-notes").html("<small>"+notesArr.join("<br />")+"</small>"),a.data("notes",t.notes).show()),a.data("chart-type",t.chartType);var r="automatic";48<t.chartData.rows.length?r=12:30<t.chartData.rows.length?r=6:20<t.chartData.rows.length?r=3:12<t.chartData.rows.length&&(r=2);e.data("show-legend");void 0!==e.data("show-legend")&&e.data("show-legend");var o,d={sliceVisibilityThreshold:0,chart:{title:t.title},colors:[],series:{},hAxis:{title:t.axis.x.label,format:"short",maxAlternation:1,maxTextLines:1,showTextEvery:r,slantedText:!1},legend:"none",curveType:"function",animation:{startup:!0,duration:1e3,easing:"out"},titleTextStyle:{fontName:"Verdana"},chartArea:{left:"13%",width:"82%"},backgroundColor:e.css("background-color")};for(o in getBreakpoint(),$.isArray(t.axis.y)&&1<t.axis.y.length?(d.chartArea.width="77%",d.vAxes=[{title:t.axis.y[0].label,format:"#,###.##"},{title:t.axis.y[1].label,format:"#,###.##"}]):$.isArray(t.axis.y)?d.vAxis={title:t.axis.y[0].label,format:"short"}:d.vAxis={title:t.axis.y.label,format:"#,###.##"},0<e.parents(".carousel ").length&&($.isArray(t.axis.y)&&1<t.axis.y.length?d.chartArea.width="80%":d.chartArea.width="100%"),t.chartData.cols)if(0<o){var n={},s=!1;void 0!==t.chartData.cols[o].color&&(s=!0,n.color=t.chartData.cols[o].color),void 0!==t.chartData.cols[o].note&&(t.chartData.cols[o].label+=t.chartData.cols[o].note),void 0!==t.chartData.cols[o].targetAxisIndex&&(s=!0,n.targetAxisIndex=t.chartData.cols[o].targetAxisIndex),void 0!==t.chartData.cols[o].role&&(s=!0,n.role=t.chartData.cols[o].role),s&&(d.series[o-1]=n)}var c=$.extend(!0,{},d);c.backgroundColor="#ffffff";var h=new google.visualization.DataTable(t.chartData);switch(t.chartType){case"area":var l=new google.visualization.AreaChart(document.getElementById(t.chartId)),p=new google.visualization.AreaChart(document.getElementById(t.chartId+"-print"));break;case"bar":l=new google.visualization.BarChart(document.getElementById(t.chartId)),p=new google.visualization.BarChart(document.getElementById(t.chartId+"-print"));break;case"column":l=new google.visualization.ColumnChart(document.getElementById(t.chartId)),p=new google.visualization.ColumnChart(document.getElementById(t.chartId+"-print"));break;case"combo":l=new google.visualization.ComboChart(document.getElementById(t.chartId)),p=new google.visualization.ComboChart(document.getElementById(t.chartId+"-print"));break;case"scatter":l=new google.visualization.ScatterChart(document.getElementById(t.chartId)),p=new google.visualization.ScatterChart(document.getElementById(t.chartId+"-print"));break;case"line":default:l=new google.visualization.LineChart(document.getElementById(t.chartId)),p=new google.visualization.LineChart(document.getElementById(t.chartId+"-print"))}l.draw(h,d),chartsLog[t.chartId]={chartId:t.chartId,chartData:h,chartObj:l,options:d,chartObjPrint:p,printOptions:c,drawChart:!0,drawPrint:!1,viewData:new google.visualization.DataView(h),viewOptions:d,viewPrintOptions:c},toggleChartSeries(t.chartId,!0),setTimeout(function(){tourAfterDrawn()},1e3)}function renderChartLoading(t){if(0===t.find(".chart-loading").length)t.append('<div class="chart-loading" data-count="1"><div class="chart-loading-text"><span class="fa fa-spinner fa-spin"></span><br /><br />Please wait a moment while we generate your real-time report</div></div>'),t.find(".chart-loading").fadeIn();else{var a=parseInt(t.find(".chart-loading").data("count"));t.find(".chart-loading").data("count",a+1)}}function renderPrintableChart(o,d,n){d=void 0!==d?d:null,n=void 0!==n&&n;var s,c=chartsLog[o],t="#ffffff";switch(d){case"image":case"imageMulti":t="#ffffff";break;case"pdf":case"pdfMulti":case"pdfReport":t="#f1f1f1"}if(c.printOptions.backgroundColor!==t&&(c.drawPrint=!1),c.printOptions.backgroundColor=t,c.viewPrintOptions.backgroundColor=t,!c.drawPrint){var h=google.visualization.events.addListener(c.chartObjPrint,"ready",function(){chartsLog[o].drawPrint=!0,google.visualization.events.removeListener(h),renderPrintableChart(o,d,n)});return c.chartObjPrint.draw(c.chartData,c.printOptions),!1}h=google.visualization.events.addListener(c.chartObjPrint,"ready",function(){var e=$(".chart-item-data[data-chart-id="+o+"]"),t=c.chartObjPrint.getImageURI();$(".chart-item[data-chart-id="+c.chartId+"] .download-btn").data("img",t),e.data("img",t);var a=$("#chart-legend-"+c.chartId),i=$("#chart-print-legend-"+c.chartId),r=i.parents(".chart-print-item");i.html(a.html()),s=$(document).scrollTop(),$(window).scrollTop(0),r.addClass("chart-print-processing"),html2canvas(i,{onrendered:function(t){r.removeClass("chart-print-processing"),$("html, body").scrollTop(s);var a=t.toDataURL("image/png");switch(i.html('<img src="'+a+'" />'),e.data("legend",a),d){case"image":downloadChartImage(o,!1,n);break;case"imageMulti":downloadChartImage(o,!0,n);break;case"pdf":downloadPDF(o,!1);break;case"pdfMulti":downloadPDF(o,!0)}}}),chartDrawCount--,google.visualization.events.removeListener(h)});c.chartObjPrint.draw(c.viewData,c.viewPrintOptions)}function downloadChartImage(a,t,e){chartsLog[a];var i=$(".chart-item-data[data-chart-id="+a+"]");if(e)$("#chartShareModal").modal("show"),$.ajax({url:siteData.data("url")+"/site/downloadImage/",type:"post",dataType:"json",contentType:"application/x-www-form-urlencoded",data:i.data(),success:function(t){t.valid&&($("#chartShareModal #FormShare_image").val(t.url),0<t.shortUrl.length?(addthis.update("share","url",t.shortUrl),addthis.update("share","media",t.shortUrl)):(addthis.update("share","url",t.url),addthis.update("share","media",t.url)),addthis.update("share","title",$(".chart-item[data-chart-id="+a+"] .chart-item-title").text()),addthis.toolbox(".addthis_toolbox"))}});else if(t){var r=i.parents(".chart-group"),o={},d=!0;r.find(".chart-item-data").each(function(t){void 0!==$(this).data("img")&&0<$(this).data("img").length?o[t]=$(this).data():d=!1}),d&&!$.isEmptyObject(o)&&$.ajax({url:siteData.data("url")+"/site/downloadAllImage/",type:"post",dataType:"json",contentType:"application/x-www-form-urlencoded",data:{charts:o,type:r.data("chart-type")},success:function(t){t.valid&&triggerFileDownload(t.url,t.filename)}})}else $.ajax({url:siteData.data("url")+"/site/downloadImage/",type:"post",dataType:"json",contentType:"application/x-www-form-urlencoded",data:i.data(),success:function(t){t.valid&&triggerFileDownload(t.url,t.filename)}})}function triggerFileDownload(t,a){var e=document.createElement("a");e.href=t,e.download=a,document.body.appendChild(e),e.click(),e.remove()}function addChart(t,a){var e="",i="";for(e in a)i+=" data-"+e+'="'+a[e]+'"';t.find(".chart-group-data").append('<div class="chart-item-data"'+i+"></div>")}function filterLists(r,o,d){d=void 0!==d?d:"list",$.ajax({url:siteData.data("url")+"/site/filterList/",data:o,dataType:"json",method:"post",success:function(i){if(i.valid&&void 0!==i.list)switch(d){case"dropdown":for(var t in r.find("option").prop("disabled",!0),i.list){var a=!0;if(void 0!==i.hide)for(var e in i.hide)if(i.list[t]===i.hide[e]){a=!1;break}a&&r.find("option[value="+i.list[t]+"]").prop("disabled",!1)}r.selectpicker("refresh");break;case"list":if(r.find(".chart-search-list-column").hide(),r.find(".chart-search-list-subgroup").hide(),r.find(".list-group-item").each(function(){var t=$(this).data("ref");"string"!=typeof t&&(t<1e3&&(t="0"+t),t=t.toString());var a=!1,e=!1;-1<Object.values(i.list).indexOf(t)&&(a=!0),void 0!==i.hide&&-1!==$.inArray(t,i.hide)&&(a=!(e=!0)),a&&!e?($(this).parents(".chart-search-list-column").show(),$(this).parents(".chart-search-list-subgroup").show(),$(this).removeClass("list-group-item-disabled").show()):!a&&e?$(this).addClass("list-group-item-disabled").hide():($(this).parents(".chart-search-list-column").show(),$(this).parents(".chart-search-list-subgroup").show(),$(this).addClass("list-group-item-disabled").show())}),void 0!==o.field&&0<$("#"+o.field).length&&$("#"+o.field).data("filter",i.list),void 0!==o.selected&&r.data("select-disable",o.selected),void 0!==o.countryReport)o.countryReport[0].url=o.countryReport[0].url+"&filter="+i.list.join(","),"undefined"===$("#reporter").data("ref")||""===$("#reporter").data("ref")||-1<i.list.indexOf($("#reporter").data("ref"))||$("#reporter").data("ref","").typeahead("val",""),crValidateSubmitBtn(!1),refreshTypeahead("countryReport",o.countryReport,!1),0===$(".list-group-item:not(.list-group-item-disabled)").length?($(".reporter-field-label").html("No countries available, select different indicators"),$(".search-list-container .form-group").addClass("disabled")):($(".reporter-field-label").html('Select a country (<span class="country-count">'+$(".list-group-item:not(.list-group-item-disabled)").length+"</span> Available)"),$(".search-list-container .form-group").removeClass("disabled")),$(".search-list-container .form-group").removeClass("loading")}else switch(d){case"dropdown":r.find("option").prop("disabled",!1),r.selectpicker("refresh");break;case"list":r.find(".list-group-item").removeClass("list-group-item-disabled")}}})}function refreshTypeahead(i,t,e){for(var a in e=void 0!==e&&e,t){var r=t[a];$(r.selector).each(function(){var t=$(this).typeahead("val"),a=void 0!==$(this).data("ref")?$(this).data("ref"):"";e||$(this).data("ref","").typeahead("val","").typeahead("destroy"),r.bloodhound=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:r.url,wildcard:"%QUERY"},sufficient:10}),r.bloodhound.initialize(),$(this).typeahead({hint:!1,highlight:!0},{limit:10,name:"search",displayKey:"value",source:r.bloodhound.ttAdapter()}),$(this).typeahead("val",t),$(this).data("ref",a)}),e&&$(r.selector).on("typeahead:selected",function(t,a,e){$(this).data("ref",a.code),validateSubmitBtn(i)}).on("keyup",function(t){""===$(this).typeahead("val")?($(this).data("ref",""),validateSubmitBtn(i)):13===t.which&&0<$(this).parents(".form-group").find(".tt-suggestion:first-child").length&&$(this).parents(".form-group").find(".tt-suggestion:first-child").trigger("click")})}toggleClearBtns()}function toggleClearBtns(){$(".form-typeahead input").each(function(){""!==$(this).val()?($(this).parents(".form-group").find(".toggleBtn").hide(),$(this).parents(".form-group").find(".clearBtn").show()):($(this).parents(".form-group").find(".clearBtn").hide(),$(this).parents(".form-group").find(".toggleBtn").show())})}function validateSubmitBtn(t){switch(t){case"countryReport":crValidateSubmitBtn();break;case"dash":dashValidateSubmitBtn();break;case"market":case"commodity":case"currency":case"equity":marketValidateSubmitBtn();break;case"macro":macroValidateSubmitBtn();break;case"trade":tradeValidateSubmitBtn()}toggleClearBtns()}function downloadCSV(t){var i={},a=$(".chart-group:first");if($.isArray(t))$.each(t,function(t,a){var e=$(".chart-item-data[data-chart-id="+a+"]");e.parents(".chart-group");i[a]=e.data(),i[a].img=""});else{var e=$(".chart-item-data[data-chart-id="+t+"]");a=e.parents(".chart-group");i[t]=e.data(),i[t].img=""}var r="/trade/downloadCsv/";void 0!==a.data("chart-type")&&(r="/"+a.data("chart-type")+"/downloadCsv/"),$.ajax({url:siteData.data("url")+r,type:"post",dataType:"json",data:i,success:function(t){t.valid&&triggerFileDownload(t.url,t.filename)}})}function downloadPDF(t,a){var e={};if(a=void 0!==a&&a){(r=$(".chart-item-data[data-chart-id="+t+"]").parents(".chart-group")).find(".chart-item-data").each(function(){e[$(this).data("chart-id")]=$(this).data()})}else{var i=$(".chart-item-data[data-chart-id="+t+"]"),r=i.parents(".chart-group");e[t]=i.data()}var o="/trade/downloadPdf/";void 0!==r.data("chart-type")&&(o="/"+r.data("chart-type")+"/downloadPdf/"),renderChartLoading(r),$.ajax({url:siteData.data("url")+o,type:"post",dataType:"json",data:e,success:function(t){t.valid&&(triggerFileDownload(t.url,t.filename),r.find(".chart-loading").fadeOut(function(){$(this).remove()}))}})}function tableFixedHeader(){return!1}$(function(){$(".modal").on("hidden.bs.modal",function(t){$(".chart-search-list").slideUp()}),$(".chart-modal").click(function(t){0<$(t.target).parents(".chart-search-list, .toggleBtn").length||$(t.target).hasClass("toggleBtn")||$(".chart-search-list").slideUp()}),$(document).on("click",".form-typeahead .toggleBtn",function(){var i=$(this).parents(".modal, .search-list-container"),t=i.find("."+$(this).data("toggle")),a=$(this).parents(".form-typeahead").find("input").attr("id"),e=i.data("chart-id");if(i.find(".chart-search-list .list-group-item-selected").removeClass("list-group-item-disabled list-group-item-selected"),i.find(".form-typeahead input").each(function(){void 0!==$(this).data("ref")&&""!==$(this).data("ref")&&i.find(".chart-search-list .list-group-item[data-ref="+$(this).data("ref")+"]").addClass("list-group-item-disabled list-group-item-selected")}),i.find(".chart-search-list").each(function(){if(void 0!==$(this).data("select-disable"))for(var t in restrict=$(this).data("select-disable"),restrict)if(0<=restrict[t].indexOf(",")){var a=restrict[t].split(",");for(var e in a)i.find(".chart-search-list .list-group-item[data-ref="+a[e]+"]").addClass("list-group-item-disabled list-group-item-selected")}else i.find(".chart-search-list .list-group-item[data-ref="+restrict[t]+"]").addClass("list-group-item-disabled list-group-item-selected")}),void 0!==e){var r=$(".chart-item-data[data-chart-id="+e+"]").data();if(void 0!==r){var o=["reporter","partner","sector","commodity","currency","equity"];for(var d in o){var n,s=o[d];if(t.is(".chart-search-list-"+s)&&void 0!==r[s]&&""!==r[s])if(0<(n=r[s].split(",")).length)for(var c=0;c<n.length;c++)if(void 0!==n[c]&&""!==n[c]){var h=i.find(".chart-search-list .list-group-item[data-ref="+n[c]+"]");h.is(".list-group-item-selected")||(i.is(".chart-modal-compare")?h.addClass("list-group-item-disabled list-group-item-selected"):h.addClass("list-group-item-selected").removeClass("list-group-item-disabled"))}}switch(s){case"reporter":case"commodity":case"currency":case"equity":var l=s;break;default:l=""}if(""!==l)if(t.is(".chart-search-list-"+l)&&void 0!==r.compare&&""!==r.compare)if(0<(n=r.compare.split(",")).length)for(c=0;c<n.length;c++)void 0!==n[c]&&""!==n[c]&&i.find(".chart-search-list .list-group-item[data-ref="+n[c]+"]").addClass("list-group-item-disabled list-group-item-selected")}}t.data("field",a),setTimeout(function(){i.animate({scrollTop:t.offset().top-$(document).scrollTop()},500)},500)}),$(document).on("click",".chart-search-list .list-group-item",function(){if(!$(this).is(".list-group-item-disabled")){var t=$("#"+$(this).parents(".chart-search-list").data("field"));t.data("ref",$(this).data("ref")),t.typeahead("val",$(this).data("label")),$(this).parents("modal").animate({scrollTop:0},500),$(".chart-search-list").slideUp(),validateSubmitBtn($(this).parents(".modal, .search-list-container").data("type"))}}),$(".form-typeahead .clearBtn").click(function(){$(this).parents(".form-group").find("input").data("ref","").typeahead("val",""),validateSubmitBtn($(this).parents(".modal, .search-list-container").data("type"))})}),$(function(){$(document).on("click",".toggle-favorite",function(){var a=$(this),t=a.parents(".chart-item").data("chart-id"),e=a.data("type");if(void 0!==t){var i=$(".chart-item-data[data-chart-id="+t+"]").data();i["favorite-type"]=e,i.img="",$.ajax({url:siteData.data("url")+"/user/toggleFavorites/",data:i,dataType:"json",method:"post",success:function(t){t.valid&&("add"===t.action?(a.html('<span class="fa fa-star"></span> Remove Favorite'),a.parents(".chart-item-header").find(".chart-item-title").prepend('<span class="fa fa-star"></span>')):(a.html('<span class="fa fa-star"></span> Add Favorite'),a.parents(".chart-item-header").find(".chart-item-title .fa-star").remove(),0<a.parents(".user-favorite").length&&a.parents(".user-favorite").slideUp(function(){$(this).remove()})))}})}})}),$(function(){tableFixedHeader()});